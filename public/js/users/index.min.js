/**
 *  Init datatables
 *
 */
function initDatatables() {
    var $dataTable = $("#users-datatables");
    if ($.fn.DataTable.isDataTable($dataTable)) {
        $dataTable.DataTable().ajax.reload(null, false);
    } else {
        $dataTable.DataTable({
            responsive: true,
            processing: true,
            serverSide: true,
            order: [0, "desc"],
            ajax: $("#users-datatables").attr("data-source"),
            createdRow: function (row, data, dataIndex, cells) {
                $(row).addClass("record-row");
            },
            columns: [
                {
                    data: 'created-at',
                    name: 'users.created_at',
                    className: 'align-middle text-center',
                    width: '15%',
                    title: 'Tgl. Daftar',
                },
                {
                    data: 'name',
                    name: 'userDetail.name',
                    className: 'align-middle',
                    title: 'Nama Lengkap',
                },
                {
                    data: 'email',
                    name: 'users.email',
                    className: 'align-middle',
                    width: '30%',
                    title: 'Email',
                    searchable: false,
                    orderable: false,
                },
                {
                    data: 'action',
                    name: 'action',
                    title: "",
                    width: "15%",
                    className: 'align-middle text-right',
                    orderable: false,
                    searchable: false
                }
            ]
        });
    }
}

/**
 *  Create user
 *
 *  @param {*} element
 */
function createUser(element) {
    SweetModal.launch({
        modal: {
            style: {
                type: "success",
                size: "lg",
                title: "Akun Pendaftar Baru",
                submitButtonText: "Buat akun pendaftar Baru",
            },
            body: {
                url: element.attr("href")
            }
        },
        swal: {
            title: "Buat Akun Pendaftar Baru",
            text: "Ingin membuat akun pendaftar baru?",
        },
        processing: {
            loadingData: {
                title: "Membuat akun pendaftar baru...",
                text: "",
            },
            after: initDatatables
        },
    });
}

/**
 *  Edit user
 *
 *  @param {*} element
 */
function editUser(element) {
    SweetModal.launch({
        modal: {
            style: {
                type: "warning",
                size: "lg",
                title: "Edit Akun Pendaftar",
                submitButtonText: "Ubah & Simpan",
            },
            body: {
                url: element.attr("href")
            }
        },
        swal: {
            title: "Edit Akun Pendaftar",
            text: "Ingin mengubah akun pendaftar ini?",
        },
        processing: {
            loadingData: {
                title: "Mengubah akun pendaftar...",
                text: "",
            },
            after: initDatatables
        },
    });
}

/**
 *  Delete user
 *
 *  @param {*} element
 */
function deleteUser(element) {
    SweetModal.launch({
        swal: {
            title: "Hapus Akun Pendaftar",
            text: "Ingin menghapus akun pendaftar ini?",
        },
        processing: {
            loadingData: {
                title: "Menghapus akun pendaftar...",
                text: "",
            },
            url: element.attr("href"),
            after: initDatatables
        },
    });
}

$(document).ready(function () {

    initDatatables();

    $("body").on("click", ".btn-create-user", function (e) {
        e.preventDefault();
        createUser($(this));
    });

    $("body").on("click", ".btn-edit-user", function (e) {
        e.preventDefault();
        editUser($(this));
    });

    $("body").on("click", ".btn-delete-user", function (e) {
        e.preventDefault();
        deleteUser($(this));
    });

});
