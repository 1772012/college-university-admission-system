/**
 *  Fetch study programs
 *
 *  @param {*} element
 */
function fetchStudyPrograms(element) {
    $.ajax({
        method: "GET",
        data: {
            faculty_id: element.val()
        },
        url: $('#form--study-program').attr('data-source'),
        success: function (response) {
            $("#study-program").empty();
            $("#study-program").append(`
                <option selected disabled hidden>Pilih program studi...</option>
            `);
            $.each(response, function (code, name) {
                var option = new Option(name, code);
                $("#study-program").append(option);
            });
            if ($("#form--study-program").hasClass("hidden")) {
                $("#form--study-program").toggleClass("hidden", false);
            }
            if ($("#form--submit").hasClass("hidden")) {
                $("#form--submit").toggleClass("hidden", false);
            }
        }
    });
}

/**
 *  Create application
 *
 *  @param {*} element
 */
function createApplication(element) {
    SweetModal.launch({
        swal: {
            title: "Buat Peserta Baru",
            text: "Ingin membuat peserta baru?",
        },
        processing: {
            loadingData: {
                title: "Membuat peserta baru...",
                text: "",
            },
            data: function () {
                formData = new FormData();
                formData.append("study_program_code", $("#study-program").val());
                return formData;
            },
            url: $("#form").attr("action"),
            after: function () {
                window.location.href = element.attr('redirect-to')
            }
        },
    });
}

$(document).ready(function () {

    $("body").on("change", "#faculty", function (e) {
        e.preventDefault();
        fetchStudyPrograms($(this));
    });

    $("body").on("click", ".btn-create-application", function (e) {
        e.preventDefault();
        createApplication($(this));
    });

});
