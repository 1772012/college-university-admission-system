/**
 *  Init datatables
 *
 */
function initDatatables() {
    var $dataTable = $("#applications-datatables");
    if ($.fn.DataTable.isDataTable($dataTable)) {
        $dataTable.DataTable().ajax.reload(null, false);
    } else {
        $dataTable.DataTable({
            responsive: true,
            processing: true,
            serverSide: true,
            order: [0, "desc"],
            ajax: $("#applications-datatables").attr("data-source"),
            createdRow: function (row, data, dataIndex, cells) {
                $(row).addClass("record-row");
            },
            columns: [
                {
                    data: 'created-at',
                    name: 'applications.created_at',
                    className: 'align-middle text-center',
                    width: '15%',
                    title: 'Tgl. Daftar',
                },
                {
                    data: 'nrp',
                    name: 'nrp',
                    className: 'align-middle text-center',
                    title: 'NRP',
                },
                {
                    data: 'name',
                    name: 'user.userDetail.name',
                    className: 'align-middle',
                    title: 'Nama Lengkap',
                    searchable: false,
                    orderable: false,
                },
                {
                    data: 'application-study-program',
                    name: 'application-study-program',
                    className: 'align-middle',
                    width: '30%',
                    title: 'Program Studi',
                    searchable: false,
                    orderable: false,
                },
                {
                    data: 'status',
                    name: 'status',
                    className: 'align-middle text-center',
                    width: '10%',
                    title: 'Status',
                    searchable: false,
                    orderable: false,
                },
                {
                    data: 'action',
                    name: 'action',
                    width: '15%',
                    className: 'align-middle text-right',
                    title: '',
                    searchable: false,
                    orderable: false,
                },
            ]
        });
    }
}

/**
 *  Predict application
 *
 *  @param {*} element
 */
function predictApplication(element) {
    SweetModal.launch({
        swal: {
            title: "Proses Rekomendasi Peserta",
            text: "Ingin memproses rekomendasi peserta ini?",
        },
        processing: {
            loadingData: {
                title: "Memproses rekomendasi ke peserta...",
                text: "",
            },
            url: element.attr("href"),
            after: initDatatables
        },
    });
}

/**
 *  Mail application
 *
 *  @param {*} element
 */
function mailApplication(element) {
    SweetModal.launch({
        swal: {
            title: "Kirim Email ke Peserta",
            text: "Ingin mengirim email hasil keputusan ke peserta ini?",
        },
        processing: {
            loadingData: {
                title: "Mengirim email ke peserta...",
                text: "",
            },
            url: element.attr("href"),
            after: initDatatables
        },
    });
}

/**
 *  Delete application
 *
 *  @param {*} element
 */
function deleteApplication(element) {
    SweetModal.launch({
        swal: {
            title: "Hapus Peserta",
            text: "Ingin menghapus peserta ini?",
        },
        processing: {
            loadingData: {
                title: "Menghapus peserta...",
                text: "",
            },
            url: element.attr("href"),
            after: initDatatables
        },
    });
}

$(document).ready(function () {

    initDatatables();

    $("body").on("click", ".btn-mail-application", function (e) {
        e.preventDefault();
        mailApplication($(this));
    });

    $("body").on("click", ".btn-predict-application", function (e) {
        e.preventDefault();
        predictApplication($(this));
    });

    $("body").on("click", ".btn-delete-application", function (e) {
        e.preventDefault();
        deleteApplication($(this));
    });

});
